# PR 코드 리뷰 규칙

PR 리뷰 시 아래 규칙을 따릅니다.

## 리뷰 범위

- 변경된 파일만 리뷰
- 제외 대상: pnpm-lock.yaml, \*.d.ts (자동생성), 이미지/폰트 바이너리, .github/ 설정 파일

## 라인 번호 정확성

인라인 코멘트의 `line` 파라미터는 반드시 **diff 출력의 `+` 라인 번호**(신규 파일 기준)를 사용해야 합니다.

- diff hunk 헤더 `@@ -old,count +new,count @@`에서 `+new` 숫자가 해당 hunk의 시작 라인입니다.
- 코멘트를 달려는 코드의 정확한 라인 번호를 diff에서 직접 세어 확인합니다.
- **절대로 추정하지 말 것**: diff 출력에 실제로 보이는 라인에만 코멘트를 남깁니다.
- 변경되지 않은 라인(diff에서 공백으로 시작하는 context 라인)에도 코멘트를 남길 수 있지만, 반드시 해당 hunk 범위 내에 있어야 합니다.

## 코멘트 제한

- 인라인 코멘트는 **최대 10개**로 제한
- 우선순위: 🔴 CRITICAL > 🟡 WARNING
- 동일 심각도 내 순서: [구현 완성도] > [코드 품질] > [성능] > [테스트 품질]

## 리뷰 실행 순서

1. **정보 수집** (병렬):
   - `gh pr diff {PR_NUMBER}`
   - `gh pr view {PR_NUMBER}`
   - 기존 코멘트 조회: `gh api "repos/$GITHUB_REPOSITORY/pulls/{PR_NUMBER}/comments" --paginate`
2. **PR 설명 파싱**: `gh pr view` 결과에서 아래 필드를 추출
   - 작업사항 → 기대하는 구현 범위
   - 주요 검토 사항 → 집중 리뷰 포인트
3. **규칙 로드**: 변경 파일 유형에 맞는 SKILL.md → 해당 rules/ 파일만 **병렬로** 읽기
   3-1. 테스트 파일 `*.test.*`이 없으면 테스트 스킬은 읽지 않음
   3-2. `AGENTS.md` 는 읽지 않음
4. **맥락 파악**: 변경된 코드의 주변 맥락이 필요하면 Read/Glob/Grep으로 소스 파일 확인
5. **이슈 선별** (코멘트 작성 전 필수 단계)
   - [구현 완성도] 이슈와 [코드 품질/성능/테스트] 이슈를 모두 수집
   - 심각도순 정렬 → 상위 10개 선택
   - 이 단계에서 코멘트를 작성하지 않고, 먼저 전체 후보를 수집
6. **코멘트 작성** (병렬):
   - 인라인 코멘트: `mcp__github_inline_comment__create_inline_comment`
   - PR 요약 코멘트: `gh pr comment {PR_NUMBER} --body "..."`

## 중복 코멘트 방지

- 인라인 코멘트를 작성하기 전에 **기존 코멘트 목록**을 확인합니다.
- 같은 파일(path)의 같은 규칙(규칙명)에 대해 이미 코멘트가 존재하면 resolve 여부와 관계없이 **해당 코멘트는 건너뜁니다.**

## 리뷰 판단 기준

코멘트를 남기기 전에 반드시 **해당 코드가 실제로 규칙을 위반하는지** 맥락을 파악합니다.

- 맥락 우선: 키워드/패턴 매칭만으로 판단하지 말고, 해당 코드가 왜 그렇게 작성되었는지 주변 코드와의 관계를 확인합니다.
- 확신 없으면 생략: 작성자의 의도적 선택일 가능성을 고려하고, 확신이 없으면 코멘트를 남기지 않습니다. 10개를 채우는 것보다 정확한 코멘트가 중요합니다.

## 리뷰 카테고리

4개의 카테고리로 구분하여 리뷰. 각 카테고리의 상세 규칙은 해당 스킬 파일 또는 아래 내용을 참조.

### [구현 완성도]

PR 설명(작업사항, 주요 검토 사항)과 실제 코드 변경을 대조하여 일치 여부를 검증합니다.
별도의 스킬 파일 없이, 아래 규칙을 pr-review.md 내에서 직접 적용합니다.

#### 검증 항목

1. **작업사항 누락**: PR 설명의 작업사항에 명시되었으나 코드 변경에 반영되지 않은 항목
2. **주요 검토 사항 확인**: PR 작성자가 명시적으로 검토를 요청한 부분에 대한 집중 리뷰

### [코드 품질]

- **스킬**: `.agents/skills/petfriends-coding-guide/SKILL.md` 참조

### [성능]

- **스킬**: `.agents/skills/vercel-react-best-practices/SKILL.md` 참조
- **주의**: petfriends-coding-guide의 원칙과 충돌 시 petfriends-coding-guide을 우선합니다

### [테스트 품질]

- **스킬**: `.agents/skills/petfriends-test-conventions/SKILL.md` 참조
